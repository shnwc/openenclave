Notes on OE SDK Attestation API Design
====

This document contains notes on the concepts and assumptions behind the design of the OE SDK Attestation API as captured in document [CustomAttestation_V3.md](https://github.com/openenclave/openenclave/blob/master/docs/DesignDocs/CustomAttestation_V3.md), with the hope to help readers' understanding of the API and its usage.

# Semantics of Claims and Optional Parameters

To help clarify what goes into custom claims and what goes to optional parameters in the `oe_get_evidence()` API function, it would be good to articulate the semantics of these two fields.

- Custom claims have well-defined semantics:
  - Can be any name-value pair
  - Only meaningful to ISV attester / verifier application
    - Typically, custom claims are part of the attester instance identity or properties. They are created and maintained by the attester and not received from a verifier
    - Examples include attester public key, or a nonce generated by attester
    - These claims are passed to verifiers with integrity protection (as part of the evidence), so verifiers can use the claims to learn the identity and properties for the attester and for secure communication with the attester
  - They are always TEE agnostic
  - Signed and included in evidence as clear text by an attester plugin, and verified and reproduced by a verifier plugin, to ensure integrity protection in transmission from attester application to verifier application
    - Secret shall never be included as a custom claim. Instead a hash of a secret can be included as a claim
  - Custom claims are NOT inspected or interpreted by OE SDK / plugins
- Optional parameters semantics are the opposite of that of custom claims:
  - They are TEE and evidence format specific
  - They are interpreted and processed by OE SDK attester and verifier plugins
    - Typically, optional parameter is provided by a verifier to an attester, so the attester can generate the correct evidence that can be successfully verified by the verifier
  - They are not interpreted nor processed by ISV attester / verifier application

For SGX local attestation, the SGX target info generated by an verifier enclave for an attester enclave is a perfect fit for optional parameter in the attester enclave's call to `oe_get_evidence()`:
- For SGX local attestation, the SGX target info is generated by a verifier enclave and passed to an attester enclave
- With the received target info, the attester enclave can generate an SGX report targeted for the verifier enclave
- This SGX report can only be verified by the verifier enclave that provided by target info. Any other enclaves, either running on the local or a remote platform, won’t be able to verify this SGX report.
- The target info is SGX specific, and should not be parsed nor interpreted by the TEE-agnostic application code. It should be handled by the SGX local attestation plugins underneath the `oe_get_evidence()` API.

# Attester – Verifier Security Model and TEE Agnostic Design

- OE SDK is designed for attester and verifier software to be TEE agnostic, so that the same source code can be built for and run on different platforms
- But owners of attesters and verifiers define their security policies, and the policies are not TEE agnostic.
  - The policies define which TEEs, platforms and configurations are trusted to run attesters and verifiers.
    - They also define security properties of these entities, e.g. keypairs and certs, service provider ID / SPID for EPID, etc., that are required for attestation and security communication.
  - They define which evidence formats attesters accept, and configure the list to the verifiers.
    - Every acceptable evidence format is TEE specific.
- OE SDK provides means for the attesters and verifiers to be built and configured for specified TEEs and platforms, and to generate or verify the evidence formats according to their security policies.
  - The OE SDK attestation API enables the attesters and verifiers to discover and register supported plugins that are built, configured, and working. For a specific attester or verifier instance, the supported list of evidence might not perfectly match the list defined in the security policies.

# Authors

- Name: Shanwei Cen
    - email: shanwei.cen@intel.com
    - github user name: shnwc